<!--ng-controller="PortalController"-->
<div ng-show="pages">
    <nav>
        <ul class="nav nav-tabs">
            <li ng-repeat="page in pages"
                ng-class="{active:page.id == selectedPageId, dropdown:page.id == selectedPageId}"
                ng-include=" page.id == selectedPageId && 'currentTab'|| 'otherTab' ">
            </li>

            <script type="text/ng-template" id="currentTab">
                <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                    {{page.name}}<b class="caret"></b>
                </a>
                <!--ng-controller="CurrentPageController"-->
                <ul class="dropdown-menu">
                    <li class=""><a ng-click="edit()">Edit Page</a></li>
                    <li class=""><a ng-click="delete()">Delete Page</a></li>
                    <li class=""><a ng-click="move()">Move Page</a></li>
                    <li class="hidden"><a ng-click="export()">Export Page</a></li>
                    <li class=""><a ng-click="share()">Share Page</a></li>
                    <li class="menu-item-disabled"><a ng-click="unshare()">Remove share</a></li>
                </ul>
            </script>

            <script type="text/ng-template" id="otherTab">
                <a href="{{page.id}}">
                    {{page.name}}
                </a>
            </script>

            <li id="addPageButton">
                <a ng-click="addPage()"><i class="icon-plus"></i></a>
            </li>
        </ul>
    </nav>
    <div class="row-fluid">
        <div class="tab-content" ng-show="selectedPageId == page.id" ng-repeat="page in pages">
            <div id="emptyPageMessageWrapper" class="emptyPageMessageWrapper">
                <div class="emptyPageMessage" ng-hide="hasWidgets(page)">
                    <a href="/portal/app/store">Add widgets to this page</a>
                </div>
            </div>
            <div ng-include="'/portal/static/html/portal/partials/'+page.pageLayoutCode+'.html'"></div>
        </div>
    </div>
</div>

<script type="text/ng-template" id="editPageModal">
    <form class="form-horizontal modal-form"  ng-submit="savePage()" >
    <div class="modal-header">
        <a class="close" ng-click="close()">&times;</a>
        <h3>Add New Page</h3>
    </div>
    <div class="modal-body">
            <fieldset>
                <div class="control-group">
                    <label class="control-label" for="tab_title">Title </label>

                    <div class="controls">
                        <input id="tab_title" class="input-xlarge focused" type="text" ng-model="page.name" required
                               ng-class="{'ng-invalid':errorMsg}"/>
                        <span class="error">{{errorMsg}}</span>
                    </div>
                </div>
                <div class="control-group">
                    <label class="control-label" for="pageLayout">Select Layout </label>

                    <div class="controls">
                        <select id="pageLayout" ng-model="page.pageLayoutCode" ng-options="l.value as l.label for l in layouts">
                        </select>
                    </div>
                </div>
            </fieldset>
    </div>
    <div class="modal-footer">
        <button class="btn" type="button" ng-click="close()">Cancel</button>
        <button class="btn btn-primary" type="submit">Save</button>
    </div>
    </form>
</script>

<script type="text/ng-template" id="movePageModal">
    <div class="modal-header">
        <a class="close" ng-click="close()">&times;</a>

        <h3 id="pageMenuDialogHeader">Move This Page</h3>
    </div>
    <div class="modal-body">
        <form id="pageForm" class="form-horizontal">
            <fieldset>
                <div class="control-group" id="pageLayoutGroup">
                    <label class="control-label" for="pageLocation">Move to </label>

                    <div class="controls">
                        <select id="pageLocation" ng-model="newLocation" ng-options="l.value as l.label for l in locations">
                        </select>
                    </div>
                </div>
            </fieldset>
        </form>
    </div>
    <div class="modal-footer">
        <a id="pageMenuCloseButton" class="btn" ng-click="close()">Cancel</a>
        <a id="pageMenuUpdateButton" class="btn btn-primary" ng-click="movePage()">Move Page</a>
    </div>
</script>